<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'">
  <title>Verify Email • MyChatApp</title>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <header>
    <h1>Email Verification</h1>
    <span id="server-status">Checking server…</span>
  </header>
  <main>
    <form id="verify-form">
      <input id="token" type="text" placeholder="Verification token" required />
      <button type="submit" data-requires-online disabled>Verify</button>
    </form>
    <a onclick="alert('Coming soon')">Resend verification email</a>
  </main>
  <script src="../renderer.js"></script>
  <script>
    const submitBtn = document.querySelector('[type="submit"]');
    window.addEventListener('online-status-changed', ({detail}) => { submitBtn.disabled = !detail; });
    document.getElementById('verify-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const res = await window.api.verifyEmail({ token: document.getElementById('token').value.trim() });
        alert(res.message || 'Email verified. You can now log in.');
        location.href = 'login.html';
      } catch (err) {
        alert(err.message);
      }
    });
  </script>
</body>
</html>
