<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'">
  <title>Register • MyChatApp</title>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <header>
    <h1>Register</h1>
    <span id="server-status">Checking server…</span>
  </header>
  <main>
    <form id="register-form">
      <input id="username"   type="text"     placeholder="Username" required />
      <input id="email"      type="email"    placeholder="Email"    required />
      <input id="password"   type="password" placeholder="Password" required />
      <button type="submit" data-requires-online disabled>Register</button>
    </form>
    <a onclick="location.href='login.html'">Already have an account? Log In →</a>
  </main>
  <script src="../renderer.js"></script>
  <script>
    const submitBtn = document.querySelector('[type="submit"]');
    window.addEventListener('online-status-changed', ({detail}) => { submitBtn.disabled = !detail; });
    document.getElementById('register-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const res = await window.api.register({
          username: document.getElementById('username').value.trim(),
          email:    document.getElementById('email').value.trim(),
          password: document.getElementById('password').value,
        });
        alert(res.message || 'Registration successful. Please verify your email.');
        location.href = 'verify.html';
      } catch (err) {
        alert(err.message);
      }
    });
  </script>
</body>
</html>
